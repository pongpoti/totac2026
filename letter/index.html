<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>LEAVE LETTER</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" />
    <script async src="https://tally.so/widgets/embed.js"></script>
    <style type="text/css">
        html {
            margin: 0;
            height: 100%;
            overflow: hidden;
        }

        iframe {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            border: 0;
        }

        #body {
            display: none;
        }
    </style>
</head>

<body id="body" class="min-h-screen border-10 border-[#241e4e] relative">
    <iframe id="iframe" width="100%" height="100%" frameborder="0" marginheight="0" marginwidth="0"></iframe>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        axios.defaults.headers.post["Content-Type"] = "application/json"
        axios.defaults.headers.post["Authorization"] = "Bearer tly-ASqvEMi4UuCizMUvSXDMTaH8L2Fqe7Ax"
        const main = async () => {
            const body = document.getElementById("body")
            const iframe = document.getElementById("iframe")
            if (window.innerWidth < 481) {
                body.style.display = "block"
                const id = await form()
                iframe.src = "https://tally.so/r/" + id
            }
        }
        const form = async () => {
            const id = await createForm()
            await addWebhook(id)
            return id
        }
        const createForm = async () => {
            try {
                const groupUuid_prefix = crypto.randomUUID()
                const groupUuid_workplaceType = crypto.randomUUID()
                const { data } = await axios.post("https://api.tally.so/forms", {
                    name: "totac2026 - letter",
                    status: "PUBLISHED",
                    settings: {
                        redirectOnCompletion: {
                            safeHTMLSchema: [
                                [
                                    "https://totac2026.pongpoti.deno.net/submit"
                                ]
                            ],
                            mentions: []
                        },
                        styles: {
                            theme: "CUSTOM",
                            color: {
                                background: "#eef2ff",
                                text: "#241e4e",
                                accent: "#0070D7",
                                buttonBackground: "#241e4e",
                                buttonText: "#FFFFFF"
                            },
                            font: {
                                provider: "Google",
                                family: "Google Sans"
                            }
                        },
                    },
                    blocks: [
                        {
                            uuid: crypto.randomUUID(),
                            type: "FORM_TITLE",
                            groupUuid: crypto.randomUUID(),
                            groupType: "TEXT",
                            payload: {
                                cover: "https://storage.tally.so/3524c5a7-abf6-4944-b817-55741b363fbb/Untitled-design.png",
                                safeHTMLSchema: [
                                    [
                                        "กรุณากรอกข้อมูล"
                                    ]
                                ],
                                title: "กรุณากรอกข้อมูล"
                            }
                        },
                        {
                            uuid: crypto.randomUUID(),
                            type: "TITLE",
                            groupUuid: crypto.randomUUID(),
                            groupType: "QUESTION",
                            payload: {
                                safeHTMLSchema: [
                                    [
                                        "คำนำหน้า"
                                    ]
                                ]
                            }
                        },
                        {
                            uuid: crypto.randomUUID(),
                            type: "DROPDOWN_OPTION",
                            groupUuid: groupUuid_prefix,
                            groupType: "DROPDOWN",
                            payload: {
                                index: 0,
                                isRequired: true,
                                isFirst: true,
                                isLast: false,
                                text: "น.พ."
                            }
                        },
                        {
                            uuid: crypto.randomUUID(),
                            type: "DROPDOWN_OPTION",
                            groupUuid: groupUuid_prefix,
                            groupType: "DROPDOWN",
                            payload: {
                                isRequired: true,
                                index: 1,
                                isFirst: false,
                                isLast: false,
                                text: "พ.ญ."
                            }
                        },
                        {
                            uuid: crypto.randomUUID(),
                            type: "DROPDOWN_OPTION",
                            groupUuid: groupUuid_prefix,
                            groupType: "DROPDOWN",
                            payload: {
                                isRequired: true,
                                index: 2,
                                isFirst: false,
                                isLast: false,
                                text: "นาย"
                            }
                        },
                        {
                            uuid: crypto.randomUUID(),
                            type: "DROPDOWN_OPTION",
                            groupUuid: groupUuid_prefix,
                            groupType: "DROPDOWN",
                            payload: {
                                isRequired: true,
                                index: 3,
                                isFirst: false,
                                isLast: false,
                                text: "นาง"
                            }
                        },
                        {
                            uuid: crypto.randomUUID(),
                            type: "DROPDOWN_OPTION",
                            groupUuid: groupUuid_prefix,
                            groupType: "DROPDOWN",
                            payload: {
                                isRequired: true,
                                index: 4,
                                isFirst: false,
                                isLast: true,
                                text: "นางสาว"
                            }
                        },
                        {
                            uuid: crypto.randomUUID(),
                            type: "TITLE",
                            groupUuid: crypto.randomUUID(),
                            groupType: "QUESTION",
                            payload: {
                                safeHTMLSchema: [
                                    [
                                        "ชื่อ (พิมพ์แค่ชื่อ)"
                                    ]
                                ]
                            }
                        },
                        {
                            uuid: crypto.randomUUID(),
                            type: "INPUT_TEXT",
                            groupUuid: crypto.randomUUID(),
                            groupType: "INPUT_TEXT",
                            payload: {
                                isRequired: true,
                                placeholder: ""
                            }
                        },
                        {
                            uuid: crypto.randomUUID(),
                            type: "TITLE",
                            groupUuid: crypto.randomUUID(),
                            groupType: "QUESTION",
                            payload: {
                                safeHTMLSchema: [
                                    [
                                        "นามสกุล (พิมพ์แค่นามสกุล)"
                                    ]
                                ]
                            }
                        },
                        {
                            uuid: crypto.randomUUID(),
                            type: "INPUT_TEXT",
                            groupUuid: crypto.randomUUID(),
                            groupType: "INPUT_TEXT",
                            payload: {
                                isRequired: true,
                                placeholder: ""
                            }
                        },
                        {
                            uuid: crypto.randomUUID(),
                            type: "TITLE",
                            groupUuid: crypto.randomUUID(),
                            groupType: "QUESTION",
                            payload: {
                                safeHTMLSchema: [
                                    [
                                        "ประเภทสถานที่ทำงาน"
                                    ]
                                ]
                            }
                        },
                        {
                            uuid: crypto.randomUUID(),
                            type: "DROPDOWN_OPTION",
                            groupUuid: groupUuid_workplaceType,
                            groupType: "DROPDOWN",
                            payload: {
                                index: 0,
                                isRequired: true,
                                isFirst: true,
                                isLast: false,
                                text: "โรงพยาบาล **ในสังกัด** มหาวิทยาลัย"
                            }
                        },
                        {
                            uuid: crypto.randomUUID(),
                            type: "DROPDOWN_OPTION",
                            groupUuid: groupUuid_workplaceType,
                            groupType: "DROPDOWN",
                            payload: {
                                isRequired: true,
                                index: 1,
                                isFirst: false,
                                isLast: true,
                                text: "โรงพยาบาลที่ **ไม่อยู่สังกัด** มหาวิทยาลัย"
                            }
                        },
                        {
                            uuid: crypto.randomUUID(),
                            type: "DIVIDER",
                            groupUuid: crypto.randomUUID(),
                            groupType: "DIVIDER",
                            payload: {}
                        },
                        {
                            uuid: crypto.randomUUID(),
                            type: "TEXT",
                            groupUuid: crypto.randomUUID(),
                            groupType: "DIVIDER",
                            payload: {
                                safeHTMLSchema: [
                                    [
                                        "วิธีการพิมพ์ชื่อสถานที่ทำงาน",
                                        [
                                            [
                                                "tag",
                                                "span"
                                            ],
                                            [
                                                "font-weight",
                                                "bold"
                                            ]
                                        ]
                                    ],
                                    [
                                        "\n\n   # "
                                    ],
                                    [
                                        "กรณี",
                                        [
                                            [
                                                "tag",
                                                "span"
                                            ],
                                            [
                                                "background-color",
                                                "rgb(255, 225, 72)"
                                            ]
                                        ]
                                    ],
                                    [
                                        " โรงพยาบาลในสังกัดมหาวิทยาลัย\n   พิมพ์ชื่อเต็มตามด้วยสังกัด เช่น คณะแพทยศาสตร์วชิรพยาบาล มหาวิทยาลัยนวมินทราธิราช\n\n   # "
                                    ],
                                    [
                                        "กรณี",
                                        [
                                            [
                                                "tag",
                                                "span"
                                            ],
                                            [
                                                "background-color",
                                                "rgb(255, 225, 72)"
                                            ]
                                        ]
                                    ],
                                    [
                                        " โรงพยาบาลอื่น ๆ ( โรงพยาบาลศูนย์ , โรงพยาบาลทั่วไป , โรงพยาบาลเอกชน ... )\n   พิมพ์คำว่า \"โรงพยาบาล\" นำหน้าชื่อ  เช่น  โรงพยาบาลพุทธชินราช"
                                    ]
                                ]
                            }
                        },
                        {
                            uuid: crypto.randomUUID(),
                            type: "TITLE",
                            groupUuid: crypto.randomUUID(),
                            groupType: "QUESTION",
                            payload: {
                                safeHTMLSchema: [
                                    [
                                        "ชื่อสถานที่ทำงาน"
                                    ]
                                ]
                            }
                        },
                        {
                            uuid: crypto.randomUUID(),
                            type: "INPUT_TEXT",
                            groupUuid: crypto.randomUUID(),
                            groupType: "INPUT_TEXT",
                            payload: {
                                isRequired: true,
                                placeholder: ""
                            }
                        },
                        {
                            uuid: crypto.randomUUID(),
                            type: "TITLE",
                            groupUuid: crypto.randomUUID(),
                            groupType: "QUESTION",
                            payload: {
                                safeHTMLSchema: [
                                    [
                                        "E-mail สำหรับจัดส่งไฟล์"
                                    ]
                                ]
                            }
                        },
                        {
                            uuid: crypto.randomUUID(),
                            type: "INPUT_EMAIL",
                            groupUuid: crypto.randomUUID(),
                            groupType: "INPUT_EMAIL",
                            payload: {
                                isRequired: true,
                                placeholder: ""
                            }
                        }
                    ]
                })
                return data.id
            } catch (error) {
                console.error(error)
            }
        }
        const addWebhook = async (id) => {
            try {
                await axios.post("https://api.tally.so/webhooks", {
                    formId: id,
                    url: "https://script.google.com/macros/s/AKfycbywqGGsEJc-zjP_eGSjrWgo6_k0h9MLEdrDwUviBQehJOLM0_Ou-o0Hy6Tn9b7Q_GuvWg/exec?id=" + id,
                    eventTypes: ["FORM_RESPONSE"]
                })
            } catch (error) {
                console.error(error)
            }
        }
        //
        main()
    </script>
</body>

</html>